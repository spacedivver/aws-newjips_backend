import{_ as V,v as $,a as Y,G as K,n as z,c as E,r as d,D as H,H as G,o as c,e as l,f as t,t as n,g as M,F as D,h as F,s as J,x as O,I as Q,J as r,K as q,i as T,p as W,l as X,m as L,L as Z}from"./index-1bL1-Tb4.js";const tt="/assets/Chatting-cuate-C4TBf_wV.png",x=m=>(W("data-v-d74745c3"),m=m(),X(),m),et={style:{"background-color":"#f2f5f9"}},st={class:"container-fluid px-0",style:{height:"90vh"}},ot={key:0},at=x(()=>t("div",{class:"row align-items-center"},[t("div",{class:"col-5 ps-5 text-start",style:{"font-size":"xx-large"}},[L(" 아직 채팅이 없어요."),t("br"),L(" 버디즈와 채팅해보세요 ! ")]),t("div",{class:"col-7 text-center pt-4"},[t("img",{src:tt,style:{height:"80vh"},class:"img-fluid"})])],-1)),nt=[at],ct={key:1,class:"row g-0"},lt={class:"col-xl-3 col-lg-12 col-md-12 col-12"},dt={class:"bg-white border-end border-top",style:{height:"90vh"}},it={class:"chat-window"},rt={class:"bg-white"},_t={class:"px-4 pt-3 pb-4"},ut={class:"d-flex justify-content-between align-items-center"},ht={class:"fw-bold"},vt={"data-simplebar":"",style:{height:"80vh",overflow:"auto"}},mt={class:"tab-content",id:"tabContent"},gt={class:"tab-pane fade show active",id:"recent",role:"tabpanel","aria-labelledby":"recent-tab"},ft={class:"list-unstyled contacts-list"},pt=["onClick"],yt={class:"d-flex justify-content-between align-items-center"},xt={href:"#",class:"text-link contacts-link"},bt={class:"d-flex"},wt={class:"avatar avatar-md"},kt=["src"],St={class:"ms-2"},Ct={class:"mb-0"},It={class:"mb-0 text-muted text-truncate"},Mt={class:"text-muted"},Dt={class:"text-end"},Ft={key:0,class:"icon-shape icon-xs text-white bg-danger rounded-circle fw-bold fs-6"},qt={class:"col-xl-9 col-lg-12 col-md-12 col-12"},Tt={class:"chat-body w-100 vh-100","data-simplebar":""},Lt={class:"bg-white border-top border-bottom px-4 py-3"},Nt={class:"d-flex justify-content-between align-items-center"},jt={class:"d-flex align-items-center"},At=x(()=>t("a",{href:"#",class:"me-2 d-xl-none d-block","data-close":""},[t("i",{class:"fe fe-arrow-left"})],-1)),Rt={class:"avatar avatar-md"},Bt=["src"],Ut={class:"ms-2"},Pt={class:"mb-0"},Vt={id:"chat-messages",class:"flex px-4 py-4 overflow-auto",style:{height:"70vh"}},$t={key:0},Yt={class:"d-flex justify-content-end mb-4"},Kt={class:"d-flex w-lg-40"},zt={class:"me-3 text-end"},Et={class:"d-flex justify-content-end"},Ht={class:"card mt-2 rounded-top-md-end-0 text-white",style:{"background-color":"#8892a0"}},Gt={class:"card-body text-start p-3"},Jt={class:"mb-0"},Ot={key:1},Qt={class:"d-flex w-lg-40 mb-4"},Wt={class:"ms-3"},Xt={class:"d-flex"},Zt={class:"card mt-2 rounded-top-md-left-0"},te={class:"card-body p-3"},ee={class:"mb-0 text-dark"},se={key:2},oe={class:"d-flex justify-content-end mb-4"},ae={class:"d-flex w-lg-40"},ne={class:"me-3 text-end"},ce={class:"d-flex justify-content-end"},le={class:"card mt-2 rounded-top-md-end-0 text-white",style:{"background-color":"#8892a0"}},de={class:"card-body text-start p-3"},ie={class:"mb-0"},re={key:3},_e={class:"d-flex w-lg-40 mb-4"},ue={class:"ms-3"},he={class:"d-flex"},ve={class:"card mt-2 rounded-top-md-left-0"},me={class:"card-body p-3"},ge={class:"mb-0 text-dark"},fe={class:"px-4 py-3 mt-auto"},pe={class:"bg-white p-1 rounded-3 shadow-sm"},ye={class:"position-relative"},xe=["placeholder"],be={class:"position-absolute end-0 mt-n6 me-4"},we=x(()=>t("img",{src:Z,style:{height:"26px"}},null,-1)),ke=[we],Se={__name:"ChatPage",setup(m){const{t:b,locale:Ce}=$.useI18n();Y(),K();const N=z(),_=E(()=>N.uno),g=d([]),a=d([]),u=d(0),h=d(""),v=d(""),i=d(!1),f=d(""),p=d(null),j=async()=>{a.value=await r.getRoomList(_.value),a.value.length>0&&(k(a.value[0]),u.value=a.value[0].cno,a.value[0].requesterFrom?(h.value=a.value[0].toName,v.value=a.value[0].toImg):(h.value=a.value[0].fromName,v.value=a.value[0].fromImg),i.value=a.value[0].requesterFrom)},w=async()=>{try{a.value=await r.getRoomList(_.value)}catch(o){console.error("폴링 중 오류 발생: ",o)}},A=async()=>{g.value=await r.getChatMsgList(u.value,_.value)},k=async o=>{g.value=await r.getChatMsgList(o.cno,_.value),u.value=o.cno,o.requesterFrom?(h.value=o.toName,v.value=o.toImg):(h.value=o.fromName,v.value=o.fromImg),i.value=o.requesterFrom,await q(),C()},R=async(o,s)=>{g.value=await r.getChatMsgList(o,s),await q(),C()},S=async()=>{const o={roomId:u.value,content:f.value,fromSender:i.value};try{await r.sendMsg(o)!=null&&(f.value="",R(u.value,_.value),w())}catch(s){console.error("메시지 전송 중 오류 발생 : ",s)}},B=()=>{p.value=setInterval(()=>{w(),A(),console.log("폴링 send")},500)},U=()=>{p.value&&(clearInterval(p.value),p.value=null)},P=o=>{const s=new Date(o),e=new Date;return s.getDate()===e.getDate()&&s.getMonth()===e.getMonth()&&s.getFullYear()===e.getFullYear()?s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):s.toLocaleDateString()},y=o=>{const s=new Date(o),e=new Date;return s.getDate()===e.getDate()&&s.getMonth()===e.getMonth()&&s.getFullYear()===e.getFullYear()?s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):`${s.toLocaleDateString()} ${s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}`},C=()=>{const o=document.getElementById("chat-messages");o.scrollTop=o.scrollHeight};return H(()=>{B()}),G(()=>{U()}),j(),(o,s)=>(c(),l("div",et,[t("div",st,[a.value.length==0?(c(),l("div",ot,nt)):(c(),l("div",ct,[t("div",lt,[t("div",dt,[t("div",it,[t("div",rt,[t("div",_t,[t("div",ut,[t("div",null,[t("h3",ht,n(M(b)("common.chat")),1)])])])]),t("div",vt,[t("div",mt,[t("div",gt,[t("ul",ft,[(c(!0),l(D,null,F(a.value,e=>(c(),l("div",{key:e.cno},[t("li",{class:"py-3 px-4 chat-item contacts-item",onClick:I=>k(e)},[t("div",yt,[t("a",xt,[t("div",bt,[t("div",wt,[t("img",{src:e.requesterFrom?e.toImg:e.fromImg,alt:"",class:"rounded-circle"},null,8,kt)]),t("div",St,[t("h5",Ct,n(e.requesterFrom?e.toName:e.fromName),1),t("p",It,n(e.content),1)])])]),t("div",null,[t("small",Mt,n(P(e.updateAt)),1),t("div",Dt,[(e.requesterFrom?e.senderUnreadCount:e.receiverUnreadCount)>0?(c(),l("span",Ft," N ")):T("",!0)])])])],8,pt)]))),128))])])])])])])]),t("div",qt,[t("div",Tt,[t("div",Lt,[t("div",Nt,[t("div",jt,[At,t("div",Rt,[t("img",{src:v.value,alt:"",class:"rounded-circle"},null,8,Bt)]),t("div",Ut,[t("h4",Pt,n(h.value),1)])])])]),t("div",Vt,[(c(!0),l(D,null,F(g.value,e=>(c(),l("div",{key:e.id},[i.value&&e.fromSender==1?(c(),l("div",$t,[t("div",Yt,[t("div",Kt,[t("div",zt,[t("small",null,n(y(e.createAt)),1),t("div",Et,[t("div",Ht,[t("div",Gt,[t("p",Jt,n(e.content),1)])])])])])])])):i.value&&e.fromSender==0?(c(),l("div",Ot,[t("div",Qt,[t("div",Wt,[t("small",null,n(y(e.createAt)),1),t("div",Xt,[t("div",Zt,[t("div",te,[t("p",ee,n(e.content),1)])])])])])])):!i.value&&e.fromSender==0?(c(),l("div",se,[t("div",oe,[t("div",ae,[t("div",ne,[t("small",null,n(y(e.createAt)),1),t("div",ce,[t("div",le,[t("div",de,[t("p",ie,n(e.content),1)])])])])])])])):!i.value&&e.fromSender==1?(c(),l("div",re,[t("div",_e,[t("div",ue,[t("small",null,n(y(e.createAt)),1),t("div",he,[t("div",ve,[t("div",me,[t("p",ge,n(e.content),1)])])])])])])):T("",!0)]))),128))]),t("div",fe,[t("div",pe,[t("div",ye,[J(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>f.value=e),class:"form-control border-0 form-control-simple no-resize",placeholder:M(b)("common.chatting.placeholder"),rows:"1",onKeydown:s[1]||(s[1]=Q(e=>S(),["enter"]))},null,40,xe),[[O,f.value]])]),t("div",be,[t("button",{class:"btn btn-focus-none",onClick:s[2]||(s[2]=e=>S())},ke)])])])])])]))])]))}},Me=V(Se,[["__scopeId","data-v-d74745c3"]]);export{Me as default};
